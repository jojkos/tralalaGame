<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brainrot Clicker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #3B0764; /* Darker Purple */
            color: #E0E0E0;
            overflow-x: hidden;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
            position: relative;
        }
        .game-title {
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.7), 0 0 10px rgba(255, 165, 0, 0.5);
        }
        .game-container {
            display: flex;
            flex-direction: row; /* Always row layout */
            gap: 1.5rem;
            width: 100%;
            max-width: 1200px;
            background-color: rgba(0,0,0,0.15);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            margin-top: 1rem;
        }
        .main-game-area { /* Left column */
            flex: 3;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: rgba(0,0,0,0.2);
            border-radius: 0.75rem;
            padding: 1.5rem;
        }
        .shark-area {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-image: radial-gradient(circle, rgba(255,215,0,0.2) 0%, rgba(59,7,100,0) 70%);
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }
        .shark-image {
            cursor: pointer;
            transition: transform 0.1s ease-out;
            max-width: 100%;
            max-height: 280px;
            height: auto;
            object-fit: contain;
            filter: drop-shadow(0 0 20px rgba(255, 223, 0, 0.8));
        }
        .shark-image:active {
            transform: scale(0.95) rotate(-2deg);
        }
        .stats-display {
            text-align: center;
            font-size: 1.1rem;
            background-color: rgba(0,0,0,0.25);
            padding: 1rem;
            border-radius: 0.5rem;
            width: 100%;
        }
        .stats-display p {
            margin: 0.35rem 0;
        }
        .instruction-text {
            font-size: 0.9rem;
            color: #FFD700;
            margin-top: 0.75rem;
        }
        .upgrades-panel { /* Right column */
            flex: 2;
            background-color: #4A235A;
            padding: 1.5rem;
            border-radius: 0.75rem;
            overflow-y: auto;
            max-height: calc(100vh - 200px); /* Adjusted for mute button */
            box-shadow: inset 0 0 15px rgba(0,0,0,0.3);
        }
        .upgrades-title {
            text-shadow: 0 0 5px rgba(0,0,0,0.5);
        }
        .upgrade-button {
            background-color: #7D3C98;
            color: white;
            border: 1px solid #C39BD3;
            padding: 0.85rem 1.1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            width: 100%;
            margin-bottom: 0.85rem;
            text-align: left;
            display: flex;
            flex-direction: column;
            box-shadow: 0 3px 7px rgba(0,0,0,0.2);
        }
        .upgrade-button:hover {
            background-color: #9B59B6;
            border-color: #F4ECF7;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.3);
        }
        .upgrade-button:disabled {
            background-color: #512E5F;
            border-color: #6C3483;
            cursor: not-allowed;
            opacity: 0.6;
            transform: none;
            box-shadow: none;
        }
        .upgrade-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }
        .upgrade-name-desc strong { color: #FAD7A0; }
        .upgrade-name-desc .text-xs { color: #EAECEE; }
        .upgrade-cost { font-weight: bold; margin-left: 1rem; white-space: nowrap; color: #FDFEFE; }
        .upgrade-level { font-size: 0.8rem; opacity: 0.8; color: #D2B4DE; }
        .currency-symbol { font-size: 1.2em; }
        .click-effect {
            position: absolute;
            font-size: 1.75rem;
            font-weight: bold;
            color: #F8C471;
            pointer-events: none;
            animation: floatUp 0.8s ease-out forwards;
            text-shadow: 0 0 6px black, 0 0 8px #333;
            z-index: 1001;
        }
        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-60px) scale(1.2); opacity: 0; }
        }
        .message-box {
            position: fixed;
            bottom: 20px;
            left: 50%;
            background-color: #D35400;
            color: white;
            padding: 12px 22px;
            border-radius: 6px;
            box-shadow: 0 3px 12px rgba(0,0,0,0.25);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            visibility: hidden;
            transform: translateX(-50%) translateY(20px);
        }
        .message-box.show {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }
        .upgrades-panel::-webkit-scrollbar { width: 10px; }
        .upgrades-panel::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); border-radius: 10px; }
        .upgrades-panel::-webkit-scrollbar-thumb { background: #9B59B6; border-radius: 10px; border: 2px solid #4A235A; }
        .upgrades-panel::-webkit-scrollbar-thumb:hover { background: #8E44AD; }
        .buy-me-a-coffee {
            position: fixed;
            bottom: 15px;
            left: 15px;
            background-color: #FFDD00;
            color: #000000;
            padding: 8px 15px;
            border-radius: 20px;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 600;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: background-color 0.2s;
            z-index: 100;
        }
        .buy-me-a-coffee:hover { background-color: #FFE64D; }
        .mute-button {
            position: fixed;
            top: 15px;
            right: 15px;
            background-color: #7D3C98;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            border: 1px solid #C39BD3;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 100;
        }
        .mute-button:hover {
            background-color: #9B59B6;
        }
    </style>
</head>
<body>
    <button id="muteButton" class="mute-button">ðŸ”Š Sounds ON</button>
    <h1 class="text-4xl font-bold text-yellow-300 mb-4 text-center game-title">Brainrot Clicker</h1>

    <div class="game-container">
        <div class="main-game-area">
            <div class="shark-area" id="sharkArea">
                <img src="https://tr.rbxcdn.com/180DAY-a8273bb70d4ded6359cd241f40ef543d/420/420/Hat/Webp/noFilter" alt="Brainrot Shark" id="sharkImage" class="shark-image" onerror="this.onerror=null;this.src='https://placehold.co/300x200/003366/FFFFFF?text=Shark+Error&font=lora';">
            </div>
            <div class="stats-display">
                <p>Brain Points (ðŸ§ ): <span id="scoreDisplay">0</span></p>
                <p>ðŸ§  per Click: <span id="clickPowerDisplay">1</span></p>
                <p>ðŸ§  per Second: <span id="bpsDisplay">0</span></p>
                <p class="instruction-text">Click the shark to earn ðŸ§  and buy upgrades!</p>
            </div>
        </div>

        <div class="upgrades-panel">
            <h2 class="text-2xl font-semibold mb-4 text-yellow-200 text-center upgrades-title">Upgrades</h2>
            <div id="upgradesContainer">
                </div>
        </div>
    </div>

    <div id="messageBox" class="message-box"></div>
    <a href="https://buymeacoffee.com/jojkos" target="_blank" rel="noopener noreferrer" class="buy-me-a-coffee">â˜• Buy me a coffee</a>

    <script>
        // Game state variables
        let score = 0;
        let clickPower = 1;
        let bps = 0;

        // Initial upgrades definition
        const initialUpgrades = {
            boostClick: { id: 'boostClick', name: "Fast Fingers", description: "+1 ðŸ§  per Click", baseCost: 10, power: 1, type: "click", level: 0, icon: 'ðŸ‘†' },
            autoClick: { id: 'autoClick', name: "Clicker Bot", description: "+1 ðŸ§  per Second", baseCost: 50, power: 1, type: "bps", level: 0, icon: 'ðŸ¤–' },
            superClick: { id: 'superClick', name: "Super Strength", description: "+5 ðŸ§  per Click", baseCost: 120, power: 5, type: "click", level: 0, icon: 'ðŸ’ª' },
            brainrotFactory: { id: 'brainrotFactory', name: "Brain Factory", description: "+5 ðŸ§  per Second", baseCost: 600, power: 5, type: "bps", level: 0, icon: 'ðŸ­' },
            megaBrain: { id: 'megaBrain', name: "Mega Mind", description: "+25 ðŸ§  per Click", baseCost: 1000, power: 25, type: "click", level: 0, icon: 'ðŸ§ âœ¨' },
            aiOverlord: { id: 'aiOverlord', name: "AI Overlord", description: "+20 ðŸ§  per Second", baseCost: 5000, power: 20, type: "bps", level: 0, icon: 'ðŸ‘‘ðŸ¤–'}
        };
        let upgrades = JSON.parse(JSON.stringify(initialUpgrades));

        // DOM Elements
        const sharkImage = document.getElementById('sharkImage');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const clickPowerDisplay = document.getElementById('clickPowerDisplay');
        const bpsDisplay = document.getElementById('bpsDisplay');
        const upgradesContainer = document.getElementById('upgradesContainer');
        const messageBox = document.getElementById('messageBox');
        const muteButton = document.getElementById('muteButton');

        // --- Audio Setup (Tone.js) ---
        let audioInitialized = false;
        let soundsMuted = false;

        // Click Sound Synthesizer
        const clickSynth = new Tone.Synth({
            oscillator: { type: 'triangle8' },
            envelope: { attack: 0.01, decay: 0.1, sustain: 0.05, release: 0.2 },
            volume: -10 // Quieter click sound
        }).toDestination();

        // Background Music Synthesizer & Melody
        const musicSynth = new Tone.PolySynth(Tone.Synth, {
            oscillator: { type: 'amsine', harmonicity: 1.2 }, // A slightly 'wobbly' sound
            envelope: { attack: 0.05, decay: 0.2, sustain: 0.1, release: 0.5 },
            volume: -20 // Background music should be quieter
        }).toDestination();

        const melody = [
            { time: '0:0', note: 'C4', duration: '8n' },
            { time: '0:1', note: 'E4', duration: '8n' },
            { time: '0:2', note: 'G4', duration: '8n' },
            { time: '0:3', note: 'E4', duration: '8n' },
            { time: '1:0', note: 'D4', duration: '8n' },
            { time: '1:1', note: 'F4', duration: '8n' },
            { time: '1:2', note: 'A4', duration: '8n' },
            { time: '1:3', note: 'F4', duration: '8n' },
            { time: '2:0', note: 'C4', duration: '4n' },
            { time: '2:2', note: 'G3', duration: '4n' },
            { time: '3:0', note: 'E4', duration: '2n' },
        ];

        const musicPart = new Tone.Part((time, value) => {
            musicSynth.triggerAttackRelease(value.note, value.duration, time);
        }, melody);
        musicPart.loop = true;
        musicPart.loopEnd = '4m'; // Loop every 4 measures
        Tone.Transport.bpm.value = 100; // Slower, more "brainrotty" tempo

        async function initializeAudio() { // Made async
            if (audioInitialized) return;
            console.log("Attempting to initialize audio. Current Tone.context state:", Tone.context.state);
            try {
                await Tone.start(); // Tone.start() returns a promise, await its resolution
                console.log("Tone.start() completed. Tone.context state:", Tone.context.state);

                if (Tone.context.state === 'running') {
                    if (Tone.Transport.state !== 'started') {
                        Tone.Transport.start();
                    }
                    if (!musicPart.started) { // Check if part has already been started
                        musicPart.start(0);
                    }
                    audioInitialized = true;
                    console.log("Audio Initialized successfully. Music should be playing. Transport state:", Tone.Transport.state);
                } else {
                    console.warn("Audio context did not start or is suspended. Current state:", Tone.context.state);
                    showTemporaryMessage("Could not start audio. Please click again or check browser settings.");
                }
            } catch (e) {
                console.error("Error during Tone.start():", e);
                showTemporaryMessage("Error initializing audio.");
            }
        }
        
        muteButton.addEventListener('click', async () => { // Make async
            soundsMuted = !soundsMuted;
            if (soundsMuted) {
                Tone.Destination.mute = true;
                muteButton.textContent = 'ðŸ”‡ Sounds OFF';
                console.log("Sounds Muted. Tone.Destination.mute:", Tone.Destination.mute);
            } else {
                Tone.Destination.mute = false;
                muteButton.textContent = 'ðŸ”Š Sounds ON';
                console.log("Sounds Unmuted. Tone.Destination.mute:", Tone.Destination.mute);
                if (!audioInitialized) { 
                    await initializeAudio(); // Await the call
                }
            }
        });


        // --- Local Storage and Data Loading ---
        function saveGameState() {
            try {
                const upgradesToSave = {};
                for (const key in upgrades) {
                    upgradesToSave[key] = { level: upgrades[key].level };
                }
                const gameState = {
                    score,
                    upgrades: upgradesToSave
                };
                localStorage.setItem('brainrotClickerGameState', JSON.stringify(gameState));
            } catch (error) {
                console.error("Error saving game state to Local Storage:", error);
                showTemporaryMessage("Could not save game progress!");
            }
        }

        function loadGameState() {
            try {
                const savedStateJSON = localStorage.getItem('brainrotClickerGameState');
                if (savedStateJSON) {
                    const savedState = JSON.parse(savedStateJSON);
                    score = savedState.score || 0;
                    if (savedState.upgrades) {
                         for (const key in initialUpgrades) {
                            if (savedState.upgrades[key]) {
                                upgrades[key] = { ...initialUpgrades[key], level: savedState.upgrades[key].level || 0 };
                            } else {
                                upgrades[key] = { ...initialUpgrades[key] };
                            }
                        }
                    } else {
                        upgrades = JSON.parse(JSON.stringify(initialUpgrades));
                    }
                    recalculateStatsFromUpgrades();
                } else {
                    initializeDefaultGameState();
                }
            } catch (error) {
                console.error("Error loading game state from Local Storage:", error);
                showTemporaryMessage("Could not load saved game!");
                initializeDefaultGameState();
            }
            updateAllDisplays();
            renderUpgrades();
        }

        function initializeDefaultGameState() {
            score = 0;
            upgrades = JSON.parse(JSON.stringify(initialUpgrades));
            recalculateStatsFromUpgrades();
        }

        // --- Game Logic ---
        async function handleSharkClick(event) { // Make async
            if (!audioInitialized && !soundsMuted) { 
                await initializeAudio(); // Await the call
            }
            if (!soundsMuted && audioInitialized) { // Ensure audio is initialized before playing click sound
                clickSynth.triggerAttackRelease('C5', '16n', Tone.now()); 
            }

            score += clickPower;
            createClickEffect(event.clientX, event.clientY, clickPower);
            updateScoreDisplay();
            renderUpgrades();

            sharkImage.style.transform = 'scale(0.95) rotate(-2deg)';
            setTimeout(() => {
                sharkImage.style.transform = 'scale(1) rotate(0deg)';
            }, 80);
        }

        function createClickEffect(x, y, amount) {
            const effect = document.createElement('div');
            effect.classList.add('click-effect');
            effect.textContent = `+${formatNumber(amount)}ðŸ§ `;
            effect.style.left = `${x - 20}px`;
            effect.style.top = `${y - 35}px`;
            document.body.appendChild(effect);
            effect.addEventListener('animationend', () => effect.remove());
        }

        function calculateUpgradeCost(baseCost, level) {
            return Math.floor(baseCost * Math.pow(1.18, level));
        }

        function buyUpgrade(upgradeId) {
            const upgrade = upgrades[upgradeId];
            if (!upgrade) return;
            const currentCost = calculateUpgradeCost(upgrade.baseCost, upgrade.level);
            if (score >= currentCost) {
                score -= currentCost;
                upgrade.level++;
                recalculateStatsFromUpgrades();
                updateAllDisplays();
                renderUpgrades();
                saveGameState();
            } else {
                showTemporaryMessage("Not enough Brain Points! ðŸ§ ");
            }
        }

        function recalculateStatsFromUpgrades() {
            clickPower = 1 + Object.values(upgrades)
                .filter(u => u.type === 'click')
                .reduce((sum, u) => sum + (u.power * u.level), 0);
            bps = Object.values(upgrades)
                .filter(u => u.type === 'bps')
                .reduce((sum, u) => sum + (u.power * u.level), 0);
        }

        const SAVE_INTERVAL = 5000;

        function gameLoop() {
            if (bps > 0) {
                score += bps / 10;
                updateScoreDisplay();
                if (Math.random() < 0.05) {
                   renderUpgrades();
                }
            }
        }

        // --- UI Updates ---
        function formatNumber(num) {
            num = Math.floor(num);
            if (num < 1000) return num.toString();
            if (num < 1000000) return (num / 1000).toFixed(1).replace(/\.0$/, '') + 'K';
            if (num < 1000000000) return (num / 1000000).toFixed(1).replace(/\.0$/, '') + 'M';
            return (num / 1000000000).toFixed(1).replace(/\.0$/, '') + 'B';
        }

        function updateScoreDisplay() { scoreDisplay.textContent = formatNumber(score); }
        function updateClickPowerDisplay() { clickPowerDisplay.textContent = formatNumber(clickPower); }
        function updateBpsDisplay() { bpsDisplay.textContent = formatNumber(bps); }
        function updateAllDisplays() { updateScoreDisplay(); updateClickPowerDisplay(); updateBpsDisplay(); }

        function renderUpgrades() {
            upgradesContainer.innerHTML = '';
            for (const id in upgrades) {
                const upgrade = upgrades[id];
                const currentCost = calculateUpgradeCost(upgrade.baseCost, upgrade.level);
                const button = document.createElement('button');
                button.className = 'upgrade-button group';
                button.disabled = score < currentCost;
                button.onclick = () => buyUpgrade(id);
                button.innerHTML = `
                    <div class="upgrade-info">
                        <div class="upgrade-name-desc">
                            <strong>${upgrade.icon} ${upgrade.name}</strong>
                            <p class="text-xs opacity-80">${upgrade.description}</p>
                            <p class="upgrade-level">Level: ${upgrade.level}</p>
                        </div>
                        <div class="upgrade-cost">
                            Cost: ${formatNumber(currentCost)} <span class="currency-symbol">ðŸ§ </span>
                        </div>
                    </div>`;
                upgradesContainer.appendChild(button);
            }
        }

        function showTemporaryMessage(message) {
            messageBox.textContent = message;
            messageBox.classList.add('show');
            setTimeout(() => messageBox.classList.remove('show'), 2500);
        }

        // --- Initialize Game ---
        sharkImage.addEventListener('click', handleSharkClick); // Will become async
        loadGameState();
        setInterval(gameLoop, 100);
        setInterval(saveGameState, SAVE_INTERVAL);
    </script>
</body>
</html>
